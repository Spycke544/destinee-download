name: Discord Release Notification

on:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          RELEASE_NAME: ${{ github.event.release.name }}
          RELEASE_TAG: ${{ github.event.release.tag_name }}
          RELEASE_URL: ${{ github.event.release.html_url }}
        run: |
          curl -H "Content-Type: application/json" \
            -X POST \
            -d "{
              \"embeds\": [{
                \"title\": \"ðŸŽ® Nouvelle version du Launcher !\",
                \"description\": \"**${RELEASE_NAME}** est maintenant disponible !\",
                \"color\": 13214247,
                \"fields\": [
                  {
                    \"name\": \"ðŸ“¦ Version\",
                    \"value\": \"\`${RELEASE_TAG}\`\",
                    \"inline\": true
                  },
                  {
                    \"name\": \"ðŸ“¥ TÃ©lÃ©charger\",
                    \"value\": \"[Cliquez ici](${RELEASE_URL})\",
                    \"inline\": true
                  }
                ],
                \"footer\": {
                  \"text\": \"DestinÃ©e PVE | PVP\"
                }
              }]
            }" \
            $DISCORD_WEBHOOK
