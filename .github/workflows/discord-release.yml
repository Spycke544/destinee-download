name: Discord Release Notification

on:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          BODY=$(echo '${{ github.event.release.body }}' | sed 's/"/\\"/g' | sed ':a;N;$!ba;s/\n/\\n/g')
          
          curl -H "Content-Type: application/json" \
            -X POST \
            -d '{
              "embeds": [{
                "title": "ðŸŽ® Nouvelle version du Launcher !",
                "description": "**${{ github.event.release.name }}** est maintenant disponible !",
                "color": 13214247,
                "fields": [
                  {
                    "name": "ðŸ“‹ Changelog",
                    "value": "'"${BODY:-Pas de description}"'",
                    "inline": false
                  },
                  {
                    "name": "ðŸ“¦ Version",
                    "value": "`${{ github.event.release.tag_name }}`",
                    "inline": true
                  }
                ],
                "footer": {
                  "text": "DestinÃ©e PVE | PVP"
                },
                "url": "${{ github.event.release.html_url }}"
              }]
            }' \
            $DISCORD_WEBHOOK
